<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="jakarta.tags.core" %>
<%@ taglib prefix="fn" uri="jakarta.tags.functions" %>
<%@ taglib prefix="sec" uri="http://www.springframework.org/security/tags" %>
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>ê³µì§€ì‚¬í•­</title>
  <style>
    .notice-table {
      width: 100%;
      border-collapse: collapse;
    }
    .notice-table th, .notice-table td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
    }
    .notice-table th {
      background-color: #f5f5f5;
    }
  </style>
</head>
<body>

<h2>ğŸ“¢ ê³µì§€ì‚¬í•­</h2>

<form method="get" action="/resident/notice" id="noticeSearchForm">
  <!-- ğŸ”½ ê±´ë¬¼ ì„ íƒ -->
  <select name="bldgIdParam">
    <c:forEach var="unit" items="${unitList}">
      <option value="${unit.bldgId}" <c:if test="${selectedBldgId eq unit.bldgId}">selected</c:if>>
        ${unit.building.bldgNm}
      </option>
    </c:forEach>
  </select>

  <!-- ğŸ”½ ê³µì§€ ìœ í˜• -->
  <select name="search.noticeType">
    <option value="">-- ìœ í˜• ì „ì²´ --</option>
    <c:forEach var="code" items="${noticeTypeList}">
      <option value="${code.codeValue}" <c:if test="${search.noticeType eq code.codeValue}">selected</c:if>>
        ${code.codeName}
      </option>
    </c:forEach>
  </select>

  <!-- ğŸ”½ ê²€ìƒ‰ ëŒ€ìƒ -->
  <select name="search.searchType">
    <option value="">-- ì „ì²´ --</option>
    <option value="title" <c:if test="${search.searchType eq 'title'}">selected</c:if>>ì œëª©</option>
    <option value="content" <c:if test="${search.searchType eq 'content'}">selected</c:if>>ë‚´ìš©</option>
    <option value="title+content" <c:if test="${search.searchType eq 'title+content'}">selected</c:if>>ì œëª©+ë‚´ìš©</option>
  </select>

  <!-- ğŸ” ê²€ìƒ‰ì–´ -->
  <input type="text" name="search.searchWord" value="${search.searchWord}" placeholder="ê²€ìƒ‰ì–´ ì…ë ¥" />
  <button type="submit">ê²€ìƒ‰</button>
</form>

<!-- ğŸ“‹ ê³µì§€ ëª©ë¡ í…Œì´ë¸” -->
<table class="notice-table">
  <thead>
    <tr>
      <th>ë²ˆí˜¸</th>
      <th>ìœ í˜•</th>
      <th>ì œëª©</th>
      <th>ì‘ì„±ì</th>
      <th>ê²Œì‹œì¼</th>
      <th>ì¡°íšŒìˆ˜</th>
    </tr>
  </thead>
  <tbody>
    <c:set var="generalIndex" value="1" scope="page"/>
    <c:forEach var="notice" items="${boardList}" varStatus="status">
      <tr>
        <td>
          <c:choose>
            <c:when test="${notice.noticeType eq '002' || notice.noticeType eq '003' || notice.noticeType eq '004'}">
              &#128204;
            </c:when>
            <c:otherwise>
              ${generalIndex}
              <c:set var="generalIndex" value="${generalIndex + 1}" scope="page"/>
            </c:otherwise>
          </c:choose>
        </td>
        <td><c:out value="${notice.noticeTypeCode.codeName}"/></td>
        <td>
          <a href="/resident/notice/detail?noticeNo=${notice.noticeNo}">
            <c:choose>
              <c:when test="${fn:length(notice.brdTitlNm) > 30}">
                <c:out value="${fn:substring(notice.brdTitlNm, 0, 30)}"/>...
              </c:when>
              <c:otherwise>
                <c:out value="${notice.brdTitlNm}"/>
              </c:otherwise>
            </c:choose>
          </a>
        </td>
        <td><c:out value="${notice.member.mbrNnm}"/></td>
        <td>${notice.formattedBrdPblsDtm}</td>
        <td><c:out value="${notice.brdVwCnt}"/></td>
      </tr>
    </c:forEach>
    <c:if test="${empty boardList}">
      <tr><td colspan="6">ë“±ë¡ëœ ê³µì§€ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>
    </c:if>
  </tbody>
</table>

<!-- â• ë“±ë¡ ë²„íŠ¼ (ê¶Œí•œ ì²´í¬) -->
<sec:authorize access="hasAuthority('ADMIN') or hasAuthority('TENANCY')">
  <a href="/resident/notice/form">
    <button type="button">ê³µì§€ ë“±ë¡</button>
  </a>
</sec:authorize>

<sec:authorize access="!hasAuthority('ADMIN') and !hasAuthority('TENANCY')">
  <div style="margin-top: 10px; color: #d9534f; font-weight: bold;">
    âš ï¸ ê³µì§€ì‚¬í•­ ë“±ë¡ì€ <span style="color: #007bff;">ê´€ë¦¬ì</span> ë˜ëŠ” <span style="color: #007bff;">ì„ëŒ€ì¸</span>ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.
  </div>
</sec:authorize>

<!-- ğŸ“„ í˜ì´ì§• -->
<div class="pagination">
  <c:out value="${pagingHTML}" escapeXml="false"/>
</div>

</body>
</html>